<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Blipz - Location Chat</title>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>üí¨</text></svg>">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <a href="#main-content" class="skip-link">Skip to main content</a>
    
    <header role="banner">
        <div class="header-nav">
            <h1>Blipz</h1>
            <div class="nav-controls">
                <button class="theme-toggle" id="theme-toggle" title="Toggle dark mode" aria-label="Toggle dark mode">
                    <span id="theme-icon" aria-hidden="true">üåô</span>
                </button>
                <button class="sound-toggle" id="sound-toggle" title="Toggle sound notifications" aria-label="Toggle sound notifications">
                    <span id="sound-icon" aria-hidden="true">üîä</span>
                </button>
            </div>
        </div>
    </header>

    <main id="main-content" role="main">
        <div class="sidebar" role="complementary" aria-label="Chat room controls">
            <div id="user-info" class="card">
                <h3>Your Profile</h3>
                <div class="user-avatar-section">
                    <img id="user-avatar-preview" class="avatar" src="" alt="Your avatar">
                    <div>
                        <button id="change-avatar-btn" class="btn btn-secondary btn-sm">Change Avatar</button>
                    </div>
                </div>
                
                <div class="user-info-item">
                    <span class="info-label">Name:</span>
                    <div style="display: flex; align-items: center; gap: 0.5rem;">
                        <span id="user-name" class="info-value">Loading...</span>
                        <button id="change-name-btn" class="btn btn-secondary btn-sm" aria-label="Edit your name">Edit</button>
                    </div>
                </div>
                
                <div class="user-info-item">
                    <span class="info-label">User ID:</span>
                    <span id="user-id" class="info-value">Loading...</span>
                </div>
                
                <div class="user-info-item">
                    <span class="info-label">Location:</span>
                    <span id="geohash" class="info-value">Detecting...</span>
                </div>

                <div class="privacy-toggle-container">
                    <label for="privacy-toggle" style="flex: 1; font-weight: 500;">Privacy Mode</label>
                    <input type="checkbox" id="privacy-toggle" aria-describedby="privacy-description">
                    <div id="privacy-description" class="sr-only">Toggle privacy mode to hide your location from other users</div>
                </div>
            </div>

            <div id="join-room-by-id" class="card">
                <h3>Join Room by ID</h3>
                <div class="join-room-form">
                    <div class="input-group">
                        <label for="room-id-input">Room ID (Geohash) <span class="shortcut-hint">Press 'R' to focus</span></label>
                        <input type="text" id="room-id-input" class="form-input" placeholder="Enter 6-character room ID..." title="Press Enter to join" aria-describedby="room-id-help">
                        <div id="room-id-help" class="sr-only">Enter a 6-character room ID to join a specific chat room</div>
                    </div>
                    <button id="join-by-id-btn" class="btn btn-primary" aria-describedby="room-id-input">Join</button>
                </div>
            </div>

            <div id="recent-rooms" class="card">
                <h3>Recently Joined</h3>
                <ul class="rooms-list" role="list" aria-label="Recently joined chat rooms">
                    <!-- Recently joined rooms will be listed here -->
                </ul>
            </div>

            <div id="nearby-rooms" class="card">
                <h3>Nearby Chat Rooms</h3>
                <div class="radius-control">
                    <div class="input-group">
                        <label for="radius-input">Search Radius (km)</label>
                        <input type="number" id="radius-input" class="form-input" value="5" min="1" max="50" aria-describedby="radius-help">
                        <div id="radius-help" class="sr-only">Set the search radius in kilometers to find nearby chat rooms</div>
                    </div>
                    <button id="search-radius-btn" class="btn btn-primary">Search</button>
                </div>
                <ul class="rooms-list" role="list" aria-label="Nearby chat rooms">
                    <!-- Chat rooms will be listed here -->
                </ul>
            </div>
        </div>

        <div class="chat-container" role="main" aria-label="Chat messages">
            <div id="chat-room" class="card">
                <div class="chat-header">
                    <div class="chat-title-section">
                        <button id="back-to-rooms-btn" class="back-btn" title="Back to room selection" style="display: none;" aria-label="Back to room selection">
                            <span aria-hidden="true">‚Üê</span>
                        </button>
                        <h2 class="chat-title">Select a Chat Room</h2>
                    </div>
                    <div id="user-count" aria-live="polite">0 online</div>
                </div>
                
                <div id="messages" role="log" aria-live="polite" aria-label="Chat messages">
                    <div class="spinner-container">
                        <div class="spinner" aria-label="Loading"></div>
                    </div>
                    <!-- Messages will be displayed here -->
                </div>
                
                <div id="typing-indicator" aria-live="polite" aria-label="Typing indicator"></div>
                
                <div id="reply-context" style="display: none;" role="status">
                    <span id="reply-context-text"></span>
                    <button id="cancel-reply-btn" aria-label="Cancel reply">√ó</button>
                </div>
                
                <div id="message-input" role="form" aria-label="Send message">
                    <button id="emoji-btn" title="Add emoji" aria-label="Add emoji">üòä</button>
                    <label for="new-message" class="sr-only">Type your message</label>
                    <textarea id="new-message" class="form-input" placeholder="Type a message..." rows="1" aria-label="Type your message"></textarea>
                    <button id="send-button" class="btn btn-primary">Send</button>
                </div>
            </div>
        </div>
    </main>

    <script src="libs/ngeohash.js" defer></script>
    <script src="libs/emoji-picker-simple.js" defer></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js" defer></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-auth-compat.js" defer></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-firestore-compat.js" defer></script>
    <script src="script.js" defer></script>
</body>
</html>
